"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const S=require("react/jsx-runtime"),O=require("react"),ae=require("echarts");function ie(n){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const e in n)if(e!=="default"){const r=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,r.get?r:{enumerable:!0,get:()=>n[e]})}}return t.default=n,Object.freeze(t)}const se=ie(ae);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $=function(n,t){return $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])},$(n,t)};function Z(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");$(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var k=function(){return k=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},k.apply(this,arguments)};function ce(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var w={},E={},I={},L;function ue(){return L||(L=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=1,e=function(){return"".concat(t++)};n.default=e}(I)),I}var z={},x={},N={},B;function ee(){return B||(B=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,a=null;return function(){for(var i=this,s=arguments.length,c=new Array(s),v=0;v<s;v++)c[v]=arguments[v];clearTimeout(a),a=setTimeout(function(){r.apply(i,c)},o)}};n.default=t}(N)),N}var R={},U;function A(){if(U)return R;U=1,Object.defineProperty(R,"__esModule",{value:!0}),R.SizeSensorId=R.SensorTabIndex=R.SensorClassName=void 0;var n="size-sensor-id";R.SizeSensorId=n;var t="size-sensor-object";R.SensorClassName=t;var e="-1";return R.SensorTabIndex=e,R}var W;function le(){if(W)return x;W=1,Object.defineProperty(x,"__esModule",{value:!0}),x.createSensor=void 0;var n=e(ee()),t=A();function e(o){return o&&o.__esModule?o:{default:o}}var r=function(a,i){var s=void 0,c=[],v=function(){getComputedStyle(a).position==="static"&&(a.style.position="relative");var u=document.createElement("object");return u.onload=function(){u.contentDocument.defaultView.addEventListener("resize",h),h()},u.style.display="block",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.height="100%",u.style.width="100%",u.style.overflow="hidden",u.style.pointerEvents="none",u.style.zIndex="-1",u.style.opacity="0",u.setAttribute("class",t.SensorClassName),u.setAttribute("tabindex",t.SensorTabIndex),u.type="text/html",a.appendChild(u),u.data="about:blank",u},h=(0,n.default)(function(){c.forEach(function(y){y(a)})}),b=function(u){s||(s=v()),c.indexOf(u)===-1&&c.push(u)},g=function(){s&&s.parentNode&&(s.contentDocument&&s.contentDocument.defaultView.removeEventListener("resize",h),s.parentNode.removeChild(s),a.removeAttribute(t.SizeSensorId),s=void 0,c=[],i&&i())},D=function(u){var _=c.indexOf(u);_!==-1&&c.splice(_,1),c.length===0&&s&&g()};return{element:a,bind:b,destroy:g,unbind:D}};return x.createSensor=r,x}var q={},K;function de(){if(K)return q;K=1,Object.defineProperty(q,"__esModule",{value:!0}),q.createSensor=void 0;var n=A(),t=e(ee());function e(o){return o&&o.__esModule?o:{default:o}}var r=function(a,i){var s=void 0,c=[],v=(0,t.default)(function(){c.forEach(function(y){y(a)})}),h=function(){var u=new ResizeObserver(v);return u.observe(a),v(),u},b=function(u){s||(s=h()),c.indexOf(u)===-1&&c.push(u)},g=function(){s.disconnect(),c=[],s=void 0,a.removeAttribute(n.SizeSensorId),i&&i()},D=function(u){var _=c.indexOf(u);_!==-1&&c.splice(_,1),c.length===0&&s&&g()};return{element:a,bind:b,destroy:g,unbind:D}};return q.createSensor=r,q}var G;function fe(){if(G)return z;G=1,Object.defineProperty(z,"__esModule",{value:!0}),z.createSensor=void 0;var n=le(),t=de(),e=typeof ResizeObserver<"u"?t.createSensor:n.createSensor;return z.createSensor=e,z}var H;function ve(){if(H)return E;H=1,Object.defineProperty(E,"__esModule",{value:!0}),E.removeSensor=E.getSensor=E.Sensors=void 0;var n=r(ue()),t=fe(),e=A();function r(c){return c&&c.__esModule?c:{default:c}}var o={};E.Sensors=o;function a(c){c&&o[c]&&delete o[c]}var i=function(v){var h=v.getAttribute(e.SizeSensorId);if(h&&o[h])return o[h];var b=(0,n.default)();v.setAttribute(e.SizeSensorId,b);var g=(0,t.createSensor)(v,function(){return a(b)});return o[b]=g,g};E.getSensor=i;var s=function(v){var h=v.element.getAttribute(e.SizeSensorId);v.destroy(),a(h)};return E.removeSensor=s,E}var J;function he(){if(J)return w;J=1,Object.defineProperty(w,"__esModule",{value:!0}),w.ver=w.clear=w.bind=void 0;var n=ve(),t=function(a,i){var s=(0,n.getSensor)(a);return s.bind(i),function(){s.unbind(i)}};w.bind=t;var e=function(a){var i=(0,n.getSensor)(a);(0,n.removeSensor)(i)};w.clear=e;var r="1.0.2";return w.ver=r,w}var Q=he();function X(n,t){var e={};return t.forEach(function(r){e[r]=n[r]}),e}function T(n){return typeof n=="function"}function pe(n){return typeof n=="string"}var F,Y;function me(){return Y||(Y=1,F=function n(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,o,a;if(Array.isArray(t)){if(r=t.length,r!=e.length)return!1;for(o=r;o--!==0;)if(!n(t[o],e[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(a=Object.keys(t),r=a.length,r!==Object.keys(e).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(e,a[o]))return!1;for(o=r;o--!==0;){var i=a[o];if(!n(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}),F}var be=me();const M=ce(be);var ge=function(n){Z(t,n);function t(e){var r=n.call(this,e)||this;return r.echarts=e.echarts,r.ele=null,r.isInitialResize=!0,r}return t.prototype.componentDidMount=function(){this.renderNewEcharts()},t.prototype.componentDidUpdate=function(e){var r=this.props.shouldSetOption;if(!(T(r)&&!r(e,this.props))){if(!M(e.theme,this.props.theme)||!M(e.opts,this.props.opts)||!M(e.onEvents,this.props.onEvents)){this.dispose(),this.renderNewEcharts();return}var o=["option","notMerge","lazyUpdate","showLoading","loadingOption"];M(X(this.props,o),X(e,o))||this.updateEChartsOption(),(!M(e.style,this.props.style)||!M(e.className,this.props.className))&&this.resize()}},t.prototype.componentWillUnmount=function(){this.dispose()},t.prototype.getEchartsInstance=function(){return this.echarts.getInstanceByDom(this.ele)||this.echarts.init(this.ele,this.props.theme,this.props.opts)},t.prototype.dispose=function(){if(this.ele){try{Q.clear(this.ele)}catch(e){console.warn(e)}this.echarts.dispose(this.ele)}},t.prototype.renderNewEcharts=function(){var e=this,r=this.props,o=r.onEvents,a=r.onChartReady,i=this.updateEChartsOption();this.bindEvents(i,o||{}),T(a)&&a(i),this.ele&&Q.bind(this.ele,function(){e.resize()})},t.prototype.bindEvents=function(e,r){function o(i,s){pe(i)&&T(s)&&e.on(i,function(c){s(c,e)})}for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&o(a,r[a])},t.prototype.updateEChartsOption=function(){var e=this.props,r=e.option,o=e.notMerge,a=o===void 0?!1:o,i=e.lazyUpdate,s=i===void 0?!1:i,c=e.showLoading,v=e.loadingOption,h=v===void 0?null:v,b=this.getEchartsInstance();return b.setOption(r,a,s),c?b.showLoading(h):b.hideLoading(),b},t.prototype.resize=function(){var e=this.getEchartsInstance();if(!this.isInitialResize)try{e.resize()}catch(r){console.warn(r)}this.isInitialResize=!1},t.prototype.render=function(){var e=this,r=this.props,o=r.style,a=r.className,i=a===void 0?"":a,s=k({height:300},o);return O.createElement("div",{ref:function(c){e.ele=c},style:s,className:"echarts-for-react "+i})},t}(O.PureComponent),ye=function(n){Z(t,n);function t(e){var r=n.call(this,e)||this;return r.echarts=se,r}return t}(ge);const te={Transports:"#c6dbef",Résidentiel:"#fdb462",Tertiaire:"#ffed6f",Industrie:"#fb8072",Agriculture:"#b3de69",Déchets:"#bebada",UTCATF:"#d9d9d9",Cultures:"#F7DC6F"},Se=["#FF6B35","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#E17055","#74B9FF"];function re(n,t){const e={sectors:[]};console.log("epciData:",n),console.log("leverPercentages:",t);for(const r of n.sectors){const o=t.sectors.find(s=>s.sector_snbc===r.name);if(!o){console.warn(`Sector "${r.name}" not found in CSV data`);continue}const a=[];let i=0;switch(r.calculation_method){case"difference_repartition":i=_e(r,o,n.region,a);break;case"transposition_directe":i=Oe(r,o,n.region,a);break;case"sum_transposition":i=Ce(r,o,n,a);break;case"national_repartition":i=we(r,o,a);break;default:console.error(`Unknown calculation method: ${r.calculation_method}`)}console.log("levers:",a),a.length>0&&e.sectors.push({name:r.name,total:i,levers:a})}return e}function _e(n,t,e,r){const o=n.value2019-n.target2030;let a=0;for(const i of t.levers){const s=i.regional_percentages[e];if(s===void 0){console.warn(`Region "${e}" not found for lever "${i.name}"`);continue}const c=o*(s/100);r.push({name:i.name,contribution:c,color:i.color||void 0}),a+=c}return a}function Oe(n,t,e,r){let o=0;for(const a of t.levers){const i=a.regional_percentages[e];if(i===void 0){console.warn(`Region "${e}" not found for lever "${a.name}"`);continue}const s=n.target2030*(i/100);r.push({name:a.name,contribution:s,color:a.color||void 0}),o+=s}return o}function Ce(n,t,e,r){if(!n.source_sectors)return console.error(`Missing source_sectors for sector "${n.name}"`),0;let o=0;for(const i of n.source_sectors){const s=e.sectors.find(c=>c.name===i);s&&(o+=s.target2030)}let a=0;for(const i of t.levers){const s=i.regional_percentages[e.region];if(s===void 0){console.warn(`Region "${e.region}" not found for lever "${i.name}"`);continue}const c=o*(s/100);r.push({name:i.name,contribution:c,color:i.color||void 0}),a+=c}return a}function we(n,t,e){const r=n.value2019-n.target2030;let o=0;for(const a of t.levers){const i=Object.values(a.regional_percentages)[0];if(i===void 0){console.warn(`No percentage found for lever "${a.name}"`);continue}const s=r*(i/100);e.push({name:a.name,contribution:s,color:a.color||void 0}),o+=s}return o}const j="#74B9FF",Ee=({epciData:n,leverPercentages:t,selectedSector:e,selectedLever:r,onLeverSelected:o,onSectorSelected:a,resetZoom:i,className:s="",style:c={}})=>{const[v,h]=O.useState([]),[b,g]=O.useState("overview"),[D,y]=O.useState(null),u=te,_=O.useMemo(()=>{try{return y(null),re(n,t)}catch(d){return y(d?.message??"Unknown error"),console.error("Error processing Mondrian data:",d),{sectors:[]}}},[n,t]),P=O.useCallback(()=>b==="sector"&&v.length>0?v:_.sectors.map(d=>({name:d.name,value:Math.abs(d.total),realValue:d.total,itemStyle:{color:u[d.name]||j},children:d.levers.map(l=>({name:l.name,value:Math.abs(l.contribution),realValue:l.contribution,sector:d.name,lever:l.name,contribution:l.contribution,color:l.color||u[d.name]||j,itemStyle:{color:l.color||u[d.name]||j}}))})),[_,b,v,u]);O.useEffect(()=>{if(!e){g("overview"),h([]);return}const d=_.sectors.find(l=>l.name===e);d&&(r?(h([{name:e,value:Math.abs(d.total),realValue:d.total,children:d.levers.map(l=>({name:l.name,value:Math.abs(l.contribution),realValue:l.contribution,sector:e,lever:l.name,contribution:l.contribution,color:l.color||u[e]||j,selected:l.name===r}))}]),g("sector")):(h([{name:e,value:Math.abs(d.total),realValue:d.total,children:d.levers.map(l=>({name:l.name,value:Math.abs(l.contribution),realValue:l.contribution,sector:e,lever:l.name,contribution:l.contribution,color:l.color||u[e]||j}))}]),g("sector")))},[e,r,_,u]);const ne=O.useCallback(d=>{if(d?.data?.sector&&d?.data?.lever){const l=d.data.sector,C=d.data.lever,p=d.data.contribution,f=_.sectors.find(m=>m.name===l);if(!f)return;h([{name:l,value:Math.abs(f.total),realValue:f.total,children:f.levers.map(m=>({name:m.name,value:Math.abs(m.contribution),realValue:m.contribution,sector:l,lever:m.name,contribution:m.contribution,color:m.color||u[l]||j,selected:m.name===C}))}]),g("sector"),o?.(l,C,p)}else if(d?.data?.name&&!d?.data?.sector){const l=d.data.name,C=_.sectors.find(p=>p.name===l);h([{name:l,value:Math.abs(C?.total??0),realValue:C?.total??0,children:C?.levers.map(p=>({name:p.name,value:Math.abs(p.contribution),realValue:p.contribution,sector:l,lever:p.name,contribution:p.contribution,color:p.color||u[l]||j}))??[]}]),g("sector"),a?.(l)}},[_,o,a,u]),oe=O.useCallback(()=>{const d=P();function l(p){return p.map(f=>f.children?{...f,children:l(f.children)}:f.selected?{...f,itemStyle:{...f.itemStyle,borderColor:"#90caf9",borderWidth:1,shadowColor:"#90caf9",shadowBlur:12},opacity:1}:{...f,opacity:.5})}let C=d;return d.length===1&&d[0].children&&d[0].children.some(p=>p.selected)&&(C=[{...d[0],children:l(d[0].children)}]),{tooltip:{formatter:function(p){const f=p.data;let m="";if(f.sector&&f.lever){m+=`<strong>${f.sector}</strong><br/>`,m+=`<strong>${f.lever}</strong><br/>`;const V=f.realValue!==void 0?f.realValue:f.contribution;V!==void 0&&f.realValue!==0&&(m+=`Target: ${V.toFixed(1)} ktCO₂e`)}else m+=`<strong>${f.name}</strong><br/>`,f.realValue!==void 0&&(m+=`Total: ${f.realValue.toFixed(1)} ktCO₂e`);return m},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#333"}},series:[{type:"treemap",data:C,roam:!1,nodeClick:"drillDown",label:{show:!0,formatter:function(p){const f=p.data;if(f.sector&&f.lever){const V=f.realValue!==void 0?f.realValue:f.contribution;return`${f.lever}

${V.toFixed(1)} ktCO₂e`}const m=f.realValue!==void 0?f.realValue:f.value;return`${f.name}

${m.toFixed(1)} ktCO₂e`},fontSize:12,color:"#111"},breadcrumb:{show:!1},itemStyle:{borderColor:"#fff",borderWidth:2},levels:[{itemStyle:{borderColor:"#fff",borderWidth:2,gapWidth:2}},{itemStyle:{borderColor:"#fff",borderWidth:1,gapWidth:1}}]}]}},[P]);return D?S.jsxs("div",{className:"mondrian-error",children:[S.jsx("h4",{children:"Data processing error"}),S.jsx("p",{children:D}),S.jsx("p",{className:"mondrian-error-hint",children:"Please verify the mapping between EPCI sectors and lever percentages."})]}):S.jsxs("div",{className:`mondrian-treemap mondrian-treemap-container ${s}`,style:c,children:[(b==="sector"||e)&&S.jsxs("div",{className:"mondrian-breadcrumb",children:[S.jsx("span",{className:"mondrian-breadcrumb-item clickable",onClick:()=>{g("overview"),h([]),i?.()},children:"Overview"}),S.jsx("span",{className:"mondrian-breadcrumb-separator",children:"›"}),S.jsx("span",{className:"mondrian-breadcrumb-item",children:e}),r&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"mondrian-breadcrumb-separator",children:"›"}),S.jsx("span",{className:"mondrian-breadcrumb-item",children:r})]})]}),S.jsx(ye,{option:oe(),className:`mondrian-treemap-chart ${b!=="overview"?"with-breadcrumb":""}`,style:{height:"100%",width:"100%"},onEvents:{click:ne}})]})};exports.LEVER_COLORS=Se;exports.MondrianTreemap=Ee;exports.SECTOR_COLORS=te;exports.calculateSNBCData=re;
