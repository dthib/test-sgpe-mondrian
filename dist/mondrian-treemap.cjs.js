"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("react/jsx-runtime"),d=require("react"),C={Transports:"#c6dbef",Résidentiel:"#fdb462",Tertiaire:"#ffed6f",Industrie:"#fb8072",Agriculture:"#b3de69",Déchets:"#bebada",UTCATF:"#d9d9d9",Cultures:"#F7DC6F"},w=["#FF6B35","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#E17055","#74B9FF"];function _(t,l){const e={sectors:[]};console.log("epciData:",t),console.log("leverPercentages:",l);for(const o of t.sectors){const a=l.sectors.find(s=>s.sector_snbc===o.name);if(!a){console.warn(`Sector "${o.name}" not found in CSV data`);continue}const n=[];let r=0;switch(o.calculation_method){case"difference_repartition":r=D(o,a,t.region,n);break;case"transposition_directe":r=R(o,a,t.region,n);break;case"sum_transposition":r=x(o,a,t,n);break;case"national_repartition":r=F(o,a,n);break;default:console.error(`Unknown calculation method: ${o.calculation_method}`)}console.log("levers:",n),n.length>0&&e.sectors.push({name:o.name,total:r,levers:n})}return e}function D(t,l,e,o){const a=t.value2019-t.target2030;let n=0;for(const r of l.levers){const s=r.regional_percentages[e];if(s===void 0){console.warn(`Region "${e}" not found for lever "${r.name}"`);continue}const u=a*(s/100);o.push({name:r.name,contribution:u,color:r.color||void 0}),n+=u}return n}function R(t,l,e,o){let a=0;for(const n of l.levers){const r=n.regional_percentages[e];if(r===void 0){console.warn(`Region "${e}" not found for lever "${n.name}"`);continue}const s=t.target2030*(r/100);o.push({name:n.name,contribution:s,color:n.color||void 0}),a+=s}return a}function x(t,l,e,o){if(!t.source_sectors)return console.error(`Missing source_sectors for sector "${t.name}"`),0;let a=0;for(const r of t.source_sectors){const s=e.sectors.find(u=>u.name===r);s&&(a+=s.target2030)}let n=0;for(const r of l.levers){const s=r.regional_percentages[e.region];if(s===void 0){console.warn(`Region "${e.region}" not found for lever "${r.name}"`);continue}const u=a*(s/100);o.push({name:r.name,contribution:u,color:r.color||void 0}),n+=u}return n}function F(t,l,e){const o=t.value2019-t.target2030;let a=0;for(const n of l.levers){const r=Object.values(n.regional_percentages)[0];if(r===void 0){console.warn(`No percentage found for lever "${n.name}"`);continue}const s=o*(r/100);e.push({name:n.name,contribution:s,color:n.color||void 0}),a+=s}return a}const h="#74B9FF",N=({epciData:t,leverPercentages:l,selectedSector:e,selectedLever:o,resetZoom:a,className:n="",style:r={}})=>{const[s,u]=d.useState([]),[j,f]=d.useState("overview"),[v,g]=d.useState(null),b=C,p=d.useMemo(()=>{try{return g(null),_(t,l)}catch(m){return g(m?.message??"Unknown error"),console.error("Error processing Mondrian data:",m),{sectors:[]}}},[t,l]);return d.useEffect(()=>{if(!e){f("overview"),u([]);return}const m=p.sectors.find(c=>c.name===e);m&&(o?(u([{name:e,value:Math.abs(m.total),realValue:m.total,children:m.levers.map(c=>({name:c.name,value:Math.abs(c.contribution),realValue:c.contribution,sector:e,lever:c.name,contribution:c.contribution,color:c.color||b[e]||h,selected:c.name===o}))}]),f("sector")):(u([{name:e,value:Math.abs(m.total),realValue:m.total,children:m.levers.map(c=>({name:c.name,value:Math.abs(c.contribution),realValue:c.contribution,sector:e,lever:c.name,contribution:c.contribution,color:c.color||b[e]||h}))}]),f("sector")))},[e,o,p,b]),v?i.jsxs("div",{className:"mondrian-error",children:[i.jsx("h4",{children:"Data processing error"}),i.jsx("p",{children:v}),i.jsx("p",{className:"mondrian-error-hint",children:"Please verify the mapping between EPCI sectors and lever percentages."})]}):i.jsxs("div",{className:`mondrian-treemap mondrian-treemap-container ${n}`,style:r,children:[(j==="sector"||e)&&i.jsxs("div",{className:"mondrian-breadcrumb",children:[i.jsx("span",{className:"mondrian-breadcrumb-item clickable",onClick:()=>{f("overview"),u([]),a?.()},children:"Overview"}),i.jsx("span",{className:"mondrian-breadcrumb-separator",children:"›"}),i.jsx("span",{className:"mondrian-breadcrumb-item",children:e}),o&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"mondrian-breadcrumb-separator",children:"›"}),i.jsx("span",{className:"mondrian-breadcrumb-item",children:o})]})]}),i.jsx("div",{children:"Mondrian Treemap"})]})};exports.LEVER_COLORS=w;exports.MondrianTreemap=N;exports.SECTOR_COLORS=C;exports.calculateSNBCData=_;
